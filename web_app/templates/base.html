<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}TP-Link HS300 Power Strip Controller{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block extra_head %}{% endblock %}
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ”Œ TP-Link HS300 Power Strip Controller</h1>
            <div class="device-info" id="device-info">
                <span class="loading">Loading device information...</span>
            </div>
        </header>

        <main>
            {% block content %}{% endblock %}
        </main>

        <footer>
            <p>TP-Link HS300 Smart Power Strip Web Controller</p>
            <a href="/power_table">Power Table</a>
        </footer>
    </div>

    <script>
        // Load main.js with error handling
        (function() {
            const script = document.createElement('script');
            script.src = "{{ url_for('static', filename='js/main.js') }}";
            script.type = 'text/javascript';
            script.async = false; // Load synchronously to ensure order
            script.onerror = function() {
                console.error('Failed to load main.js from:', script.src);
                const grid = document.getElementById('outlets-grid');
                if (grid) {
                    grid.innerHTML = '<div class="error-message">Error: Failed to load main.js. Please check the browser console and ensure the file exists at: ' + script.src + '</div>';
                }
            };
            script.onload = function() {
                console.log('main.js loaded successfully from:', script.src);
                // Check immediately and after a short delay
                function checkFunctions() {
                    console.log('Checking functions...');
                    console.log('  loadOutlets:', typeof loadOutlets);
                    console.log('  window.loadOutlets:', typeof window.loadOutlets);
                    console.log('  toggleOutlet:', typeof toggleOutlet);
                    console.log('  window.toggleOutlet:', typeof window.toggleOutlet);
                    
                    if (typeof loadOutlets === 'function' || typeof window.loadOutlets === 'function') {
                        console.log('âœ“ loadOutlets is available!');
                    } else {
                        console.error('âœ— loadOutlets is still not defined after script load!');
                        console.error('Available globals:', Object.keys(window).filter(k => k.includes('load') || k.includes('toggle')));
                    }
                }
                
                // Check immediately
                checkFunctions();
                
                // Check again after a short delay
                setTimeout(checkFunctions, 100);
            };
            document.head.appendChild(script);
        })();
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>

